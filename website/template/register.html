<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/styles/home.css" />
  <link rel="stylesheet" href="/styles/register.css" />
  <title>Cr√©er un compte ‚Ä¢ Forum Y</title>
  <link id="favicon" rel="icon" href="/img/logo/inverted.png" type="image/png" />
</head>
<body>
  <!-- Banni√®re (barre lat√©rale gauche) -->
  <div class="banner">
    <div class="bar">
      <div class="logo-button">
        <img src="/img/logo/inverted.png" alt="Logo" class="icon-logo">
      </div>
      <a href="/home" class="bar-button">
        <img src="/img/icon/home-r.png" alt="Home" class="icon">
        <p>Accueil</p>
      </a>
      <a href="/theme" class="bar-button">
        <img src="/img/icon/brush-r.png" alt="Theme" class="icon">
        <p>Th√®me</p>
      </a>
      <a href="/login" class="bar-button">
        <img src="/img/icon/profile-r.png" alt="Login" class="icon">
        <p>Connexion</p>
      </a>
      <div class="account"></div>
    </div>
  </div>

  <!-- Contenu principal -->
  <div class="container">
    <div class="main">
      <!-- En-t√™te avec animation -->
      <div class="register-header">
        <div class="header-icon">‚ú®</div>
        <h1>Rejoignez notre communaut√©</h1>
        <p class="header-subtitle">Cr√©ez votre compte en quelques √©tapes simples</p>
      </div>

      <!-- Container principal du formulaire -->
      <div class="register-container">
        <!-- Affichage des erreurs -->
        <div id="error-message" class="error-alert" style="display: none;">
          <div class="error-icon">‚ö†Ô∏è</div>
          <span class="error-text"></span>
        </div>
        
        <form action="/api/register" method="POST" enctype="multipart/form-data" id="registerForm" class="register-form">
          
          <!-- Section Personnalisation du profil -->
          <div class="form-section">
            <div class="section-header">
              <h3>üé® Personnalisez votre profil</h3>
              <p>Ajoutez une touche personnelle √† votre compte</p>
            </div>
            
            <div class="profile-customization">
              <!-- Photo de profil -->
              <div class="upload-card profile-card">
                <div class="card-header">
                  <h4>Photo de profil</h4>
                  <span class="optional-badge">Optionnel</span>
                </div>
                <div class="profile-picture-upload">
                  <div class="profile-picture-preview">
                    <img id="profilePreview" src="/img/avatars/default-avatar.png" alt="Aper√ßu photo de profil" />
                    <div class="upload-overlay">
                      <div class="upload-icon">üì∑</div>
                      <p>Cliquer pour choisir</p>
                    </div>
                  </div>
                  <input type="file" id="profile-picture" name="profile_picture" accept="image/*" style="display: none;" />
                  <button type="button" id="removePhoto" class="remove-btn" style="display: none;">
                    <span>üóëÔ∏è</span> Supprimer
                  </button>
                </div>
                <p class="upload-hint">JPG, PNG ou GIF ‚Ä¢ Max 5MB</p>
              </div>

              <!-- Banni√®re de profil -->
              <div class="upload-card banner-card">
                <div class="card-header">
                  <h4>Banni√®re de profil</h4>
                  <span class="optional-badge">Optionnel</span>
                </div>
                <div class="banner-upload">
                  <div class="banner-preview" id="bannerPreview">
                    <div class="banner-placeholder">
                      <div class="placeholder-icon">üñºÔ∏è</div>
                      <p>Cliquer pour ajouter une banni√®re</p>
                      <span class="size-recommendation">Recommand√©: 1500√ó500px</span>
                    </div>
                    <div class="upload-overlay">
                      <div class="upload-icon">üì∑</div>
                      <p>Choisir une image</p>
                    </div>
                  </div>
                  <input type="file" id="banner" name="banner" accept="image/*" style="display: none;" />
                  <button type="button" id="removeBanner" class="remove-btn" style="display: none;">
                    <span>üóëÔ∏è</span> Supprimer
                  </button>
                </div>
                <p class="upload-hint">JPG, PNG ou GIF ‚Ä¢ Max 5MB ‚Ä¢ Format paysage</p>
              </div>
            </div>

            <!-- Note sur le th√®me -->
            <div class="theme-info-note">
              <p><strong>üé® Th√®me :</strong> Utilisez l'onglet "Th√®me" dans la barre lat√©rale pour personnaliser l'apparence de votre forum</p>
            </div>
          </div>

          <!-- Section Informations du compte -->
          <div class="form-section">
            <div class="section-header">
              <h3>üë§ Informations du compte</h3>
              <p>Ces informations sont n√©cessaires pour cr√©er votre compte</p>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="username" class="form-label">
                  <span class="label-icon">üè∑Ô∏è</span>
                  Nom d'utilisateur
                  <span class="required">*</span>
                </label>
                <div class="input-container">
                  <input type="text" id="username" name="username" required 
                         pattern="[a-zA-Z0-9_]{3,50}" 
                         title="3-50 caract√®res, lettres, chiffres et _ uniquement"
                         class="form-input" 
                         placeholder="votre_nom_utilisateur" />
                  <div class="input-icon">@</div>
                </div>
                <div class="input-help">3-50 caract√®res, lettres, chiffres et _ uniquement</div>
              </div>

              <div class="form-group">
                <label for="email" class="form-label">
                  <span class="label-icon">üìß</span>
                  Adresse e-mail
                  <span class="required">*</span>
                </label>
                <div class="input-container">
                  <input type="email" id="email" name="email" required 
                         class="form-input" 
                         placeholder="votre@email.com" />
                  <div class="input-icon">‚úâÔ∏è</div>
                </div>
              </div>

              <div class="form-group password-group">
                <label for="password" class="form-label">
                  <span class="label-icon">üîí</span>
                  Mot de passe
                  <span class="required">*</span>
                </label>
                <div class="input-container">
                  <input type="password" id="password" name="password" required minlength="12" 
                         class="form-input" 
                         placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                  <div class="input-icon">üîë</div>
                </div>
                <div class="password-requirements">
                  <div class="requirement" id="req-length">
                    <span class="req-icon">‚ùå</span>
                    <span>Au moins 12 caract√®res</span>
                  </div>
                  <div class="requirement" id="req-upper">
                    <span class="req-icon">‚ùå</span>
                    <span>Au moins une majuscule</span>
                  </div>
                  <div class="requirement" id="req-special">
                    <span class="req-icon">‚ùå</span>
                    <span>Au moins un caract√®re sp√©cial</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Bouton de soumission -->
          <div class="form-section">
            <button type="submit" class="submit-btn">
              <span class="btn-icon">üöÄ</span>
              <span class="btn-text">Cr√©er mon compte</span>
              <div class="btn-shine"></div>
            </button>
            
            <div class="form-footer">
              <p>D√©j√† un compte ? 
                <a href="/login" class="login-link">Se connecter</a>
              </p>
            </div>
          </div>

        </form>
      </div>
    </div>
    <div class="sidebar"></div>
  </div>

  <script>
    // Gestion de l'upload de photo de profil et de banni√®re
    document.addEventListener('DOMContentLoaded', function() {
      // √âl√©ments
      const profilePictureInput = document.getElementById('profile-picture');
      const profilePreview = document.getElementById('profilePreview');
      const profileUploadArea = document.querySelector('.profile-picture-preview');
      const removePhotoBtn = document.getElementById('removePhoto');
      
      const bannerInput = document.getElementById('banner');
      const bannerPreview = document.getElementById('bannerPreview');
      const removeBannerBtn = document.getElementById('removeBanner');

      const passwordInput = document.getElementById('password');
      
      // Upload photo de profil
      profileUploadArea.addEventListener('click', function() {
        profilePictureInput.click();
      });
      
      profilePictureInput.addEventListener('change', function(e) {
        handleImageUpload(e.target.files[0], 'profile');
      });
      
      removePhotoBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        resetProfilePicture();
      });

      // Upload banni√®re
      bannerPreview.addEventListener('click', function() {
        bannerInput.click();
      });
      
      bannerInput.addEventListener('change', function(e) {
        handleImageUpload(e.target.files[0], 'banner');
      });
      
      removeBannerBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        resetBanner();
      });

      // Validation mot de passe en temps r√©el
      passwordInput.addEventListener('input', function() {
        validatePassword(this.value);
      });

      // Fonction g√©n√©rique pour g√©rer les uploads
      function handleImageUpload(file, type) {
        if (!file) return;

        // Validation
        if (file.size > 5 * 1024 * 1024) {
          showError(`La taille de ${type === 'profile' ? 'l\'image' : 'la banni√®re'} ne doit pas d√©passer 5MB`);
          if (type === 'profile') profilePictureInput.value = '';
          else bannerInput.value = '';
          return;
        }
        
        if (!file.type.startsWith('image/')) {
          showError('Veuillez s√©lectionner un fichier image valide');
          if (type === 'profile') profilePictureInput.value = '';
          else bannerInput.value = '';
          return;
        }
        
        // Pr√©visualisation
        const reader = new FileReader();
        reader.onload = function(e) {
          if (type === 'profile') {
            profilePreview.src = e.target.result;
            removePhotoBtn.style.display = 'block';
            profileUploadArea.classList.add('has-image');
          } else {
            bannerPreview.style.backgroundImage = `url(${e.target.result})`;
            bannerPreview.classList.add('has-banner');
            removeBannerBtn.style.display = 'block';
          }
        };
        reader.readAsDataURL(file);
      }

      function resetProfilePicture() {
        profilePictureInput.value = '';
        profilePreview.src = '/img/avatars/default-avatar.png';
        removePhotoBtn.style.display = 'none';
        profileUploadArea.classList.remove('has-image');
      }

      function resetBanner() {
        bannerInput.value = '';
        bannerPreview.style.backgroundImage = '';
        bannerPreview.classList.remove('has-banner');
        removeBannerBtn.style.display = 'none';
      }

      function validatePassword(password) {
        const requirements = {
          'req-length': password.length >= 12,
          'req-upper': /[A-Z]/.test(password),
          'req-special': /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
        };

        Object.entries(requirements).forEach(([id, isValid]) => {
          const element = document.getElementById(id);
          const icon = element.querySelector('.req-icon');
          
          if (isValid) {
            element.classList.add('valid');
            icon.textContent = '‚úÖ';
          } else {
            element.classList.remove('valid');
            icon.textContent = '‚ùå';
          }
        });
      }
    });

    // Gestion du formulaire d'inscription
    document.getElementById('registerForm').addEventListener('submit', function(e) {
      const password = document.getElementById('password').value;
      const profilePictureInput = document.getElementById('profile-picture');
      const bannerInput = document.getElementById('banner');
      
      // Validation du mot de passe
      if (password.length < 12) {
        e.preventDefault();
        showError('Le mot de passe doit contenir au moins 12 caract√®res');
        return;
      }
      
      if (!/[A-Z]/.test(password)) {
        e.preventDefault();
        showError('Le mot de passe doit contenir au moins une majuscule');
        return;
      }
      
      if (!/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)) {
        e.preventDefault();
        showError('Le mot de passe doit contenir au moins un caract√®re sp√©cial');
        return;
      }
      
      // Validation des images
      [profilePictureInput, bannerInput].forEach(input => {
        if (input.files[0]) {
          const file = input.files[0];
          if (file.size > 5 * 1024 * 1024) {
            e.preventDefault();
            showError('La taille de l\'image ne doit pas d√©passer 5MB');
            return;
          }
          
          if (!file.type.startsWith('image/')) {
            e.preventDefault();
            showError('Veuillez s√©lectionner un fichier image valide');
            return;
          }
        }
      });
      
      hideError();
      
      // Animation du bouton
      const submitBtn = this.querySelector('.submit-btn');
      submitBtn.classList.add('loading');
      submitBtn.querySelector('.btn-text').textContent = 'Cr√©ation en cours...';
    });
    
    // Gestion des erreurs
    window.addEventListener('load', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const error = urlParams.get('error');
      if (error) {
        showError(decodeURIComponent(error));
      }
    });
    
    function showError(message) {
      const errorDiv = document.getElementById('error-message');
      const errorText = errorDiv.querySelector('.error-text');
      errorText.textContent = message;
      errorDiv.style.display = 'flex';
      
      // Animation d'apparition
      setTimeout(() => errorDiv.classList.add('show'), 10);
      
      // Auto-hide apr√®s 10 secondes
      setTimeout(() => hideError(), 10000);
    }
    
    function hideError() {
      const errorDiv = document.getElementById('error-message');
      errorDiv.classList.remove('show');
      setTimeout(() => errorDiv.style.display = 'none', 300);
    }
  </script>
  
  <script src="/js/theme_loader.js"></script>
  <script src="/js/auth-handler.js"></script>
</body>
</html>